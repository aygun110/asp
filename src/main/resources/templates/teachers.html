<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <title>–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–∏</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    <style>
        body {
          background-color: #f8f9fa;
        }
        .teacher-icon {
          font-size: 80px;
          color: #007bff;
        }
        .card-container {
          position: relative;
          display: flex;
          justify-content: center;
          align-items: center;
          height: auto;
          transition: opacity 0.5s ease, transform 0.5s ease;
          opacity: 1;
          transform: scale(1);
        }
        .card-container.hidden {
          opacity: 0;
          transform: scale(0.8);
        }
        .card {
          width: 100%;
          max-width: 400px;
          margin: auto;
          text-align: center;
          transition: all 0.3s ease;
        }
        .arrow {
          position: absolute;
          top: 50%;
          transform: translateY(-50%);
          font-size: 2rem;
          color: #007bff;
          cursor: pointer;
          z-index: 10;
        }
        .arrow-left {
          left: 20px;
        }
        .arrow-right {
          right: 20px;
        }
        .dots {
          display: flex;
          justify-content: center;
          margin-top: 20px;
        }
        .dot {
          width: 12px;
          height: 12px;
          margin: 0 6px;
          border-radius: 50%;
          background-color: #ccc;
          cursor: pointer;
          transition: background-color 0.3s;
        }
        .dot.active {
          background-color: #007bff;
        }
        .filter-container {
          margin-bottom: 20px;
          display: flex;
          justify-content: center;
        }
        .collapse-form {
          max-height: 0;
          overflow: hidden;
          transition: max-height 0.4s ease, opacity 0.4s ease;
          opacity: 0;
        }
        .collapse-form.show {
          max-height: 400px;
          opacity: 1;
          margin-top: 1rem;
        }
        .admin-badge {
            font-size: 1rem;
            padding: 0.35em 0.65em;
        }
        #adminTeacherCard, #userTeacherCard {
            display: block;
        }

        /* –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ */
        .modal-statistics {
            display: none;
            position: fixed;
            z-index: 1050;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
        }

        .modal-content-statistics {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 800px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .close-statistics {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close-statistics:hover,
        .close-statistics:focus {
            color: black;
            text-decoration: none;
        }

        .statistics-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .statistics-container {
            max-height: 70vh;
            overflow-y: auto;
            padding-right: 10px;
        }

        .statistics-item {
            margin-bottom: 15px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }

        .progress {
            height: 10px;
            border-radius: 5px;
        }

        .progress-bar {
            background-color: #0d6efd;
            border-radius: 5px;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .spinner-border {
            animation: spin .75s linear infinite;
        }

        /* –°—Ç–∏–ª—å –¥–ª—è –∫–Ω–æ–ø–∫–∏ –Ω–∞–∑–∞–¥ */
                .back-button {
          position: absolute;
          top: 20px;
          left: 20px;
          z-index: 1000;
          background-color: #0056b3; /* –°–∏–Ω–∏–π —Ü–≤–µ—Ç —Ñ–æ–Ω–∞ */
          color: white; /* –ë–µ–ª—ã–π —Ü–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ */
          border: none;
          padding: 8px 16px;
          border-radius: 8px;
          font-weight: 500;
          text-decoration: none;
          transition: background-color 0.3s ease;
       }

.back-button:hover {
    background-color: #003f88; /* –¢—ë–º–Ω–æ-—Å–∏–Ω–∏–π —Ü–≤–µ—Ç –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
    color: white;
}

    </style>
</head>
<body>
<a th:href="${#authorization.expression('hasRole(''ROLE_ADMIN'')') ? '/admin/index1' : '/user/home'}"
   class="btn btn-secondary back-button">
    &lt; –ù–∞–∑–∞–¥
</a>



</div>
<div th:if="${param.success}" class="alert alert-success alert-dismissible fade show position-fixed top-0 end-0 m-3" role="alert" style="z-index: 1000;">
    <strong>–£—Å–ø–µ—à–Ω–æ!</strong> –í—ã –∑–∞–ø–∏—Å–∞–Ω—ã –∫ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—é.
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
</div>


<div id="statisticsModal" class="modal-statistics">
    <div class="modal-content-statistics">
        <span class="close-statistics">&times;</span>
        <div class="statistics-header">
            <h3>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–ø–∏—Å–µ–π –ø–æ —Å–µ–∫—Ü–∏—è–º</h3>
            <button class="btn btn-sm btn-outline-secondary" onclick="refreshStatistics()">
                <i class="fas fa-sync-alt"></i> –û–±–Ω–æ–≤–∏—Ç—å
            </button>
        </div>
        <div class="statistics-container" id="statisticsContent">
            <div class="text-center py-5">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                </div>
                <p class="mt-2">–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...</p>
            </div>
        </div>
    </div>
</div>

<script>

    function initStatisticsModal() {
      const modal = document.getElementById("statisticsModal");
      const span = document.getElementsByClassName("close-statistics")[0];

      span.onclick = function() {
        closeStatisticsModal();
      }


      window.onclick = function(event) {
        if (event.target == modal) {
          closeStatisticsModal();
        }
      }
    }

    function openStatisticsModal() {
      const modal = document.getElementById("statisticsModal");
      modal.style.display = "block";
      loadStatisticsData();
    }

    function closeStatisticsModal() {
      const modal = document.getElementById("statisticsModal");
      modal.style.display = "none";
    }

    document.addEventListener('DOMContentLoaded', function() {
      initStatisticsModal();

    });
</script>

<div class="container mt-5 pt-3">

    <h2 class="mb-4 text-center">üßë‚Äçüè´ –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–∏</h2>

    <!-- –ë–ª–æ–∫ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ -->
    <div th:if="${#authentication.principal.authorities.?[authority == 'ROLE_ADMIN'].size() > 0}" id="adminSection">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è–º–∏" —Å–ª–µ–≤–∞ -->
            <h3 class="mb-0">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è–º–∏</h3>

            <!-- –ö–Ω–æ–ø–∫–∏ —Å–ø—Ä–∞–≤–∞ -->
            <div class="d-flex">
                <!-- –ö–Ω–æ–ø–∫–∞ "–ò—Å—Ç–æ—Ä–∏—è –∑–∞–ø–∏—Å–µ–π" -->
                <button class="btn btn-primary me-2" th:onclick="'window.location.href=\'' + @{/admin/history} + '\''">
                    <i class="fas fa-history me-2"></i>–ò—Å—Ç–æ—Ä–∏—è –∑–∞–ø–∏—Å–µ–π
                </button>
                <!-- –ö–Ω–æ–ø–∫–∞ "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞" -->
                <button class="btn btn-secondary" onclick="openStatisticsModal()">
                    <i class="fas fa-chart-line"></i>
                </button>
            </div>
        </div>

        <p class="text-center mb-4">
            –í –Ω–∞—à–µ–π —Å–ø–æ—Ä—Ç–∏–≤–Ω–æ–π —à–∫–æ–ª–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ–º–∞–Ω–¥–∞ –æ–ø—ã—Ç–Ω—ã—Ö –∏ –∫–≤–∞–ª–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π, –ø—Ä–µ–¥–∞–Ω–Ω—ã—Ö —Å–≤–æ–µ–º—É –¥–µ–ª—É.
        </p>

        <!-- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –≤–∏–¥–∞–º —Å–ø–æ—Ä—Ç–∞ –¥–ª—è –∞–¥–º–∏–Ω–∞ -->
        <div class="filter-container">
            <select id="adminSportFilter" class="form-select w-50" onchange="filterAdminTeachers()">
                <option value="all">–í—Å–µ –≤–∏–¥—ã —Å–ø–æ—Ä—Ç–∞</option>
                <option value="–§—É—Ç–±–æ–ª">–§—É—Ç–±–æ–ª</option>
                <option value="–ì–∏–º–Ω–∞—Å—Ç–∏–∫–∞">–ì–∏–º–Ω–∞—Å—Ç–∏–∫–∞</option>
                <option value="–û–§–ü">–û–§–ü / –ê—Ç–ª–µ—Ç–∏–∫–∞</option>
                <option value="–ü–ª–∞–≤–∞–Ω–∏–µ">–ü–ª–∞–≤–∞–Ω–∏–µ</option>
                <option value="–î–∑—é–¥–æ">–î–∑—é–¥–æ / –ë–æ–µ–≤—ã–µ –∏—Å–∫—É—Å—Å—Ç–≤–∞</option>
                <option value="–ë–∞—Å–∫–µ—Ç–±–æ–ª">–ë–∞—Å–∫–µ—Ç–±–æ–ª</option>
                <option value="–õ—ë–≥–∫–∞—è –∞—Ç–ª–µ—Ç–∏–∫–∞">–õ—ë–≥–∫–∞—è –∞—Ç–ª–µ—Ç–∏–∫–∞</option>
                <option value="–°–∞–º–±–æ">–°–∞–º–±–æ</option>
            </select>
        </div>

        <!-- –ö–∞—Ä—É—Å–µ–ª—å –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π –¥–ª—è –∞–¥–º–∏–Ω–∞ -->
        <div class="card-container" id="adminCardContainer">
            <div id="adminTeacherCard" class="card shadow p-4">
            </div>
        </div>

        <!-- –°—Ç—Ä–µ–ª–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –¥–ª—è –∞–¥–º–∏–Ω–∞ -->
        <div class="arrow arrow-left" onclick="changeAdminSlide(-1)">
            <i class="fa-solid fa-chevron-left"></i>
        </div>
        <div class="arrow arrow-right" onclick="changeAdminSlide(1)">
            <i class="fa-solid fa-chevron-right"></i>
        </div>

        <!-- –¢–æ—á–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –¥–ª—è –∞–¥–º–∏–Ω–∞ -->
        <div class="dots" id="adminDotsContainer"></div>
    </div>


    <!-- –ë–ª–æ–∫ –¥–ª—è –æ–±—ã—á–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
    <div th:unless="${#authentication.principal.authorities.?[authority == 'ROLE_ADMIN'].size() > 0}" id="userSection">
        <p class="text-center mb-4">
            –í –Ω–∞—à–µ–π —Å–ø–æ—Ä—Ç–∏–≤–Ω–æ–π —à–∫–æ–ª–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ–º–∞–Ω–¥–∞ –æ–ø—ã—Ç–Ω—ã—Ö –∏ –∫–≤–∞–ª–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π, –ø—Ä–µ–¥–∞–Ω–Ω—ã—Ö —Å–≤–æ–µ–º—É –¥–µ–ª—É.
        </p>

        <!-- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –≤–∏–¥–∞–º —Å–ø–æ—Ä—Ç–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
        <div class="filter-container">
            <select id="userSportFilter" class="form-select w-50" onchange="filterUserTeachers()">
                <option value="all">–í—Å–µ –≤–∏–¥—ã —Å–ø–æ—Ä—Ç–∞</option>
                <option value="–§—É—Ç–±–æ–ª">–§—É—Ç–±–æ–ª</option>
                <option value="–ì–∏–º–Ω–∞—Å—Ç–∏–∫–∞">–ì–∏–º–Ω–∞—Å—Ç–∏–∫–∞</option>
                <option value="–û–§–ü">–û–§–ü / –ê—Ç–ª–µ—Ç–∏–∫–∞</option>
                <option value="–ü–ª–∞–≤–∞–Ω–∏–µ">–ü–ª–∞–≤–∞–Ω–∏–µ</option>
                <option value="–î–∑—é–¥–æ">–î–∑—é–¥–æ / –ë–æ–µ–≤—ã–µ –∏—Å–∫—É—Å—Å—Ç–≤–∞</option>
                <option value="–ë–∞—Å–∫–µ—Ç–±–æ–ª">–ë–∞—Å–∫–µ—Ç–±–æ–ª</option>
                <option value="–õ—ë–≥–∫–∞—è –∞—Ç–ª–µ—Ç–∏–∫–∞">–õ—ë–≥–∫–∞—è –∞—Ç–ª–µ—Ç–∏–∫–∞</option>
                <option value="–°–∞–º–±–æ">–°–∞–º–±–æ</option>
            </select>
        </div>

        <!-- –ö–∞—Ä—É—Å–µ–ª—å –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
        <div class="card-container" id="userCardContainer">
            <div id="userTeacherCard" class="card shadow p-4">
            </div>
        </div>

        <!-- –°—Ç—Ä–µ–ª–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
        <div class="arrow arrow-left" onclick="changeUserSlide(-1)">
            <i class="fa-solid fa-chevron-left"></i>
        </div>
        <div class="arrow arrow-right" onclick="changeUserSlide(1)">
            <i class="fa-solid fa-chevron-right"></i>
        </div>

        <!-- –¢–æ—á–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
        <div class="dots" id="userDotsContainer"></div>
    </div>
</div>

<script>
    const teachers = [
      {
        name: "–ò–≤–∞–Ω–æ–≤ –ê–ª–µ–∫—Å–µ–π –°–µ—Ä–≥–µ–µ–≤–∏—á",
        sport: "–§—É—Ç–±–æ–ª",
        text: "42 –≥–æ–¥–∞<br>–¢—Ä–µ–Ω–µ—Ä –ø–æ —Ñ—É—Ç–±–æ–ª—É, –º–∞—Å—Ç–µ—Ä —Å–ø–æ—Ä—Ç–∞, –æ–ø—ã—Ç —Ä–∞–±–æ—Ç—ã –±–æ–ª–µ–µ 10 –ª–µ—Ç.",
        schedule: "–ü–Ω, –°—Ä, –ü—Ç: 16:00-20:00"
      },
      {
        name: "–ü–µ—Ç—Ä–æ–≤–∞ –ú–∞—Ä–∏–Ω–∞ –í–∏–∫—Ç–æ—Ä–æ–≤–Ω–∞",
        sport: "–ì–∏–º–Ω–∞—Å—Ç–∏–∫–∞",
        text: "38 –ª–µ—Ç<br>–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å –ø–æ —Ö—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–π –≥–∏–º–Ω–∞—Å—Ç–∏–∫–µ, —Å—É–¥—å—è –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.",
        schedule: "–í—Ç, –ß—Ç: 15:00-19:00, –°–±: 10:00-14:00"
      },
      {
        name: "–°–º–∏—Ä–Ω–æ–≤ –î–º–∏—Ç—Ä–∏–π –ü–∞–≤–ª–æ–≤–∏—á",
        sport: "–û–§–ü",
        text: "45 –ª–µ—Ç<br>–ò–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –ø–æ –æ–±—â–µ—Ñ–∏–∑–∏—á–µ—Å–∫–æ–π –ø–æ–¥–≥–æ—Ç–æ–≤–∫–µ, –∫–∞–Ω–¥–∏–¥–∞—Ç –ø–µ–¥–∞–≥–æ–≥–∏—á–µ—Å–∫–∏—Ö –Ω–∞—É–∫.",
        schedule: "–ü–Ω-–ü—Ç: 9:00-12:00, 17:00-20:00"
      },
      {
        name: "–ö—É–∑–Ω–µ—Ü–æ–≤–∞ –ï–ª–µ–Ω–∞ –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–Ω–∞",
        sport: "–ü–ª–∞–≤–∞–Ω–∏–µ",
        text: "34 –≥–æ–¥–∞<br>–¢—Ä–µ–Ω–µ—Ä –ø–æ –ø–ª–∞–≤–∞–Ω–∏—é, –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω—ã–π –ø—Ä–∏–∑—ë—Ä –≤—Å–µ—Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–π.",
        schedule: "–í—Ç, –ß—Ç, –°–±: 7:00-10:00, 16:00-19:00"
      },
      {
        name: "–û—Ä–ª–æ–≤ –ù–∏–∫–æ–ª–∞–π –ò–≥–æ—Ä–µ–≤–∏—á",
        sport: "–î–∑—é–¥–æ",
        text: "40 –ª–µ—Ç<br>–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å –ø–æ –¥–∑—é–¥–æ, —á—ë—Ä–Ω—ã–π –ø–æ—è—Å, —É—á–∞—Å—Ç–Ω–∏–∫ –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã—Ö —Ç—É—Ä–Ω–∏—Ä–æ–≤.",
        schedule: "–ü–Ω, –°—Ä, –ü—Ç: 18:00-21:00"
      },
      {
        name: "–§—ë–¥–æ—Ä–æ–≤ –ê—Ä—Ç—ë–º –í–ª–∞–¥–∏–º–∏—Ä–æ–≤–∏—á",
        sport: "–ë–∞—Å–∫–µ—Ç–±–æ–ª",
        text: "36 –ª–µ—Ç<br>–¢—Ä–µ–Ω–µ—Ä –ø–æ –±–∞—Å–∫–µ—Ç–±–æ–ª—É, –ö–ú–°, –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å –ø–æ –∫–æ–º–∞–Ω–¥–Ω—ã–º –≤–∏–¥–∞–º —Å–ø–æ—Ä—Ç–∞.",
        schedule: "–í—Ç, –ß—Ç: 17:00-20:00, –°–±: 11:00-15:00"
      },
      {
        name: "–ì—Ä–æ–º–æ–≤–∞ –ê–Ω–Ω–∞ –°–µ—Ä–≥–µ–µ–≤–Ω–∞",
        sport: "–û–§–ü",
        text: "29 –ª–µ—Ç<br>–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø–æ –û–§–ü –∏ –ª—ë–≥–∫–æ–π –∞—Ç–ª–µ—Ç–∏–∫–µ, —É—á–∞—Å—Ç–Ω–∏–∫ –≤—Å–µ—Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö –º–∞—Ä–∞—Ñ–æ–Ω–æ–≤.",
        schedule: "–ü–Ω-–°–±: 8:00-11:00"
      },
      {
        name: "–ú–µ–ª—å–Ω–∏–∫–æ–≤ –°—Ç–µ–ø–∞–Ω –ê—Ä–∫–∞–¥—å–µ–≤–∏—á",
        sport: "–°–∞–º–±–æ",
        text: "43 –≥–æ–¥–∞<br>–¢—Ä–µ–Ω–µ—Ä –ø–æ —Å–∞–º–±–æ, –º–∞—Å—Ç–µ—Ä —Å–ø–æ—Ä—Ç–∞, –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å –±–æ–µ–≤—ã—Ö –∏—Å–∫—É—Å—Å—Ç–≤.",
        schedule: "–ü–Ω, –°—Ä, –ü—Ç: 19:00-22:00"
      },
      {
        name: "–õ–µ–±–µ–¥–µ–≤–∞ –ò—Ä–∏–Ω–∞ –Æ—Ä—å–µ–≤–Ω–∞",
        sport: "–õ—ë–≥–∫–∞—è –∞—Ç–ª–µ—Ç–∏–∫–∞",
        text: "32 –≥–æ–¥–∞<br>–¢—Ä–µ–Ω–µ—Ä –ø–æ –ª—ë–≥–∫–æ–π –∞—Ç–ª–µ—Ç–∏–∫–µ, —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ‚Äì —Å–ø—Ä–∏–Ω—Ç –∏ –ø—Ä—ã–∂–∫–∏ –≤ –¥–ª–∏–Ω—É.",
        schedule: "–í—Ç, –ß—Ç: 16:00-19:00, –°–±: 9:00-12:00"
      }
    ];


    const carousels = {
      admin: {
        currentIndex: 0,
        filteredTeachers: teachers,
        cardId: "adminTeacherCard",
        containerId: "adminCardContainer",
        dotsContainerId: "adminDotsContainer",
        isAdmin: true,
      },
      user: {
        currentIndex: 0,
        filteredTeachers: teachers,
        cardId: "userTeacherCard",
        containerId: "userCardContainer",
        dotsContainerId: "userDotsContainer",
        isAdmin: false,
      }
    };


    document.addEventListener('DOMContentLoaded', function () {
      renderCard("admin");
      renderCard("user");
      updateDots("admin");
      updateDots("user");

      initStatisticsModal();
    });


    function renderCard(role) {
      const carousel = carousels[role];
      const teacher = carousel.filteredTeachers[carousel.currentIndex];
      const card = document.getElementById(carousel.cardId);
      const container = document.getElementById(carousel.containerId);

      container.classList.add("hidden");

      setTimeout(() => {
        card.innerHTML = `
          <i class="fa-solid fa-circle-user teacher-icon mb-3"></i>
          <h5 class="card-title">${teacher.name}</h5>
          <h6 class="card-subtitle mb-2 text-muted">${teacher.sport}</h6>
          <p class="card-text">${teacher.text}</p>
          <div class="mt-3">
              ${!carousel.isAdmin
                ? `<button class="btn btn-success w-100" onclick="toggleUserForm()">
                     <i class="fas fa-calendar-plus me-2"></i>–ó–∞–ø–∏—Å–∞—Ç—å—Å—è
                   </button>
                   <div id="userRegisterForm" class="collapse-form">
                      <form method="post" action="/register-to-teacher" class="mt-3">
                          <input type="hidden" name="teacherName" value="${teacher.name}">
                          <input type="hidden" name="sportType" value="${teacher.sport}">

                          <div class="mb-3">
                              <label class="form-label">–í–∞—à–µ –∏–º—è</label>
                              <input type="text" name="userName" class="form-control" required>
                          </div>

                          <div class="mb-3">
                              <label class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                              <input type="tel" name="phone" class="form-control" required>
                          </div>
                          <div class="mb-3">
                              <label class="form-label">–ì—Ä—É–ø–ø–∞</label>
                              <input type="text" name="groupName" class="form-control" required>
                          </div>

                          <div class="mb-3">
                             <label class="form-label">–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</label>
                               <input type="text" name="schedule" class="form-control" value="${teacher.schedule}" readonly />
                           </div>


                          <button type="submit" class="btn btn-primary w-100">
                              <i class="fas fa-check me-2"></i>–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∑–∞–ø–∏—Å—å
                          </button>
                      </form>
                   </div>`
                : ''}
          </div>
        `;

        setTimeout(() => {
          container.classList.remove("hidden");
        }, 50);

        updateDots(role);
      }, 250);
    }


    function changeSlide(role, direction) {
      const carousel = carousels[role];
      const len = carousel.filteredTeachers.length;
      carousel.currentIndex = (carousel.currentIndex + direction + len) % len;
      renderCard(role);
    }

    function filterTeachers(role) {
      const value = document.getElementById(role + "SportFilter").value;
      carousels[role].filteredTeachers =
        value === "all"
          ? teachers
          : teachers.filter(t => t.sport === value);
      carousels[role].currentIndex = 0;
      renderCard(role);
      updateDots(role);
    }

    function updateDots(role) {
      const { filteredTeachers, currentIndex, dotsContainerId } = carousels[role];
      const dotsContainer = document.getElementById(dotsContainerId);
      dotsContainer.innerHTML = '';

      filteredTeachers.forEach((_, i) => {
        const dot = document.createElement("div");
        dot.className = `dot ${i === currentIndex ? "active" : ""}`;
        dot.onclick = () => {
          carousels[role].currentIndex = i;
          renderCard(role);
        };
        dotsContainer.appendChild(dot);
      });
    }

    function toggleUserForm() {
      const form = document.getElementById("userRegisterForm");
      form.classList.toggle("show");
    }


    function filterAdminTeachers() {
      filterTeachers("admin");
    }

    function filterUserTeachers() {
      filterTeachers("user");
    }


    function changeAdminSlide(dir) {
      changeSlide("admin", dir);
    }

    function changeUserSlide(dir) {
      changeSlide("user", dir);
    }


    function initStatisticsModal() {
      const modal = document.getElementById("statisticsModal");
      const span = document.getElementsByClassName("close-statistics")[0];

      span.onclick = function() {
        modal.style.display = "none";
      }

      window.onclick = function(event) {
        if (event.target == modal) {
          modal.style.display = "none";
        }
      }
    }

    function openStatisticsModal() {
      const modal = document.getElementById("statisticsModal");
      modal.style.display = "block";
      loadStatisticsData();
    }

    function loadStatisticsData() {
      // –ó–∞–ø—Ä–æ—Å –∫ —Å–µ—Ä–≤–µ—Ä—É –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
      fetch('/api/statistics/sections')
        .then(response => {
          if (!response.ok) {
            throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏');
          }
          return response.json();
        })
        .then(data => {
          // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –æ–±—ä–µ–∫—Ç –≤ –º–∞—Å—Å–∏–≤ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
          const statsArray = Object.keys(data).map(sport => ({
            sport: sport,
            count: data[sport]
          }));

          // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —É–±—ã–≤–∞–Ω–∏—é –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–ø–∏—Å–µ–π
          statsArray.sort((a, b) => b.count - a.count);

          // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏ –ø—Ä–æ—Ü–µ–Ω—Ç—ã
          const total = statsArray.reduce((sum, item) => sum + item.count, 0);
          const statsWithPercentage = statsArray.map(item => ({
            ...item,
            percentage: total > 0 ? Math.round((item.count / total) * 100) : 0
          }));

          displayStatistics(statsWithPercentage, total);
        })
        .catch(error => {
          console.error('Error loading statistics:', error);
          // –ò—Å–ø–æ–ª—å–∑—É–µ–º mock –¥–∞–Ω–Ω—ã–µ –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏
          const mockStatistics = [
            { sport: "–§—É—Ç–±–æ–ª", count: 45, percentage: 30 },
            { sport: "–ì–∏–º–Ω–∞—Å—Ç–∏–∫–∞", count: 32, percentage: 21 },
            { sport: "–ü–ª–∞–≤–∞–Ω–∏–µ", count: 28, percentage: 19 },
            { sport: "–î–∑—é–¥–æ", count: 18, percentage: 12 },
            { sport: "–û–§–ü", count: 15, percentage: 10 },
            { sport: "–ë–∞—Å–∫–µ—Ç–±–æ–ª", count: 8, percentage: 5 },
            { sport: "–õ—ë–≥–∫–∞—è –∞—Ç–ª–µ—Ç–∏–∫–∞", count: 4, percentage: 3 }
          ];
          const total = mockStatistics.reduce((sum, item) => sum + item.count, 0);
          displayStatistics(mockStatistics, total);
        });
    }

    function displayStatistics(data, total) {
      const container = document.getElementById("statisticsContent");
      let html = '';

      // –ù–∞—Ö–æ–¥–∏–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —à–∏—Ä–∏–Ω—ã progress bar
      const maxCount = Math.max(...data.map(item => item.count), 1); // –º–∏–Ω–∏–º—É–º 1 —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –¥–µ–ª–µ–Ω–∏—è –Ω–∞ 0

      data.forEach(item => {
        html += `
          <div class="statistics-item">
            <div class="d-flex justify-content-between mb-1">
              <span><strong>${item.sport}</strong></span>
              <span>${item.count} –∑–∞–ø–∏—Å–µ–π (${item.percentage}%)</span>
            </div>
            <div class="progress">
              <div class="progress-bar" role="progressbar"
                   style="width: ${(item.count / maxCount) * 100}%"
                   aria-valuenow="${item.count}"
                   aria-valuemin="0"
                   aria-valuemax="${maxCount}">
              </div>
            </div>
          </div>
        `;
      });


      html = `
        <div class="alert alert-info">
          <strong>–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π:</strong> ${total}
        </div>
        ${html}

        <div class="mt-4">
          <canvas id="statisticsChart" height="300"></canvas>
        </div>
      `;

      container.innerHTML = html;

      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –≥—Ä–∞—Ñ–∏–∫
      initChart(data);
    }

    function initChart(data) {

      if (typeof Chart === 'undefined') {
        const script = document.createElement('script');
        script.src = 'https://cdn.jsdelivr.net/npm/chart.js';
        script.onload = () => renderChart(data);
        document.head.appendChild(script);
      } else {
        renderChart(data);
      }
    }

    function renderChart(data) {
      const ctx = document.getElementById('statisticsChart').getContext('2d');

      // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞
      const labels = data.map(item => item.sport);
      const counts = data.map(item => item.count);
      const backgroundColors = [
        'rgba(54, 162, 235, 0.7)',
        'rgba(255, 99, 132, 0.7)',
        'rgba(75, 192, 192, 0.7)',
        'rgba(255, 159, 64, 0.7)',
        'rgba(153, 102, 255, 0.7)',
        'rgba(255, 205, 86, 0.7)',
        'rgba(201, 203, 207, 0.7)'
      ];

      new Chart(ctx, {
        type: 'bar',
        data: {
          labels: labels,
          datasets: [{
            label: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π',
            data: counts,
            backgroundColor: backgroundColors,
            borderColor: backgroundColors.map(color => color.replace('0.7', '1')),
            borderWidth: 1
          }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    display: false
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return `–ó–∞–ø–∏—Å–µ–π: ${context.raw}`;
                        }
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π'
                    },
                    ticks: {
                        stepSize: 1
                    }
                },
                x: {
                    title: {
                        display: true,
                        text: '–°–µ–∫—Ü–∏–∏'
                    }
                }
            }
        }
      });
    }

    function displayError(error) {
      const container = document.getElementById("statisticsContent");
      container.innerHTML = `
        <div class="alert alert-danger">
          <i class="fas fa-exclamation-triangle"></i>
          –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏: ${error.message}
        </div>
        <button class="btn btn-primary" onclick="loadStatisticsData()">
          <i class="fas fa-redo"></i> –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
        </button>
      `;
    }

    function refreshStatistics() {
      const container = document.getElementById("statisticsContent");
      container.innerHTML = `
        <div class="text-center py-5">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
          </div>
          <p class="mt-2">–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...</p>
        </div>
      `;
      loadStatisticsData();
    }
</script>


<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</body>
</html>